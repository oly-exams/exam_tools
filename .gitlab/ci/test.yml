test:pre-commit:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: pre-commit
        OVERWRITE_COMPOSE: $DOCKER_DIR/overwrite/pre-commit-diff.yml

test:django-server:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: django-server
        OVERWRITE_COMPOSE: $DOCKER_DIR/overwrite/django-server-test.yml
    artifacts:
        when: always
        reports:
            junit: unittest_reports/*.xml

test:docker-a-dev-setup:
    extends: .test:pull_and_run
    variables:
        COMPOSE_FILE: a-dev-compose.sh
        ALL_SERVICE_NAME: django-server postgres rabbitmq celery-worker
        OVERWRITE_COMPOSE: $DOCKER_DIR/overwrite/a-dev-test.yml


test:testing-cypress-batch-1:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: django-server testing-cypress
        OVERWRITE_COMPOSE: $DOCKER_DIR/overwrite/testing-cypress.yml $DOCKER_DIR/overwrite/testing-cypress-batch-1.yml
    after_script: &batch_after
        # copying makes the folderstructure look nicer on gitlab
        - mkdir $CI_PROJECT_DIR/screenshots
        - cp -r $CI_PROJECT_DIR/e2e/cypress/screenshots/* $CI_PROJECT_DIR/screenshots
        # videos are not used at the moment
        #- mkdir $CI_PROJECT_DIR/videos
        #- cp -r e2e/cypress/videos/* $CI_PROJECT_DIR/videos
    artifacts: &batch_artifacts
        when: always
        paths:
            #- $CI_PROJECT_DIR/videos
            - $CI_PROJECT_DIR/screenshots
        reports:
            junit: $CI_PROJECT_DIR/e2e/cypress/reports/*.xml

test:testing-cypress-batch-2:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: django-server testing-cypress
        OVERWRITE_COMPOSE: $DOCKER_DIR/overwrite/testing-cypress.yml $DOCKER_DIR/overwrite/testing-cypress-batch-2.yml
    after_script: *batch_after
    artifacts:
        <<: *batch_artifacts

test:testing-cypress-batch-3:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: django-server testing-cypress
        OVERWRITE_COMPOSE: $DOCKER_DIR/overwrite/testing-cypress.yml $DOCKER_DIR/overwrite/testing-cypress-batch-3.yml
    after_script: *batch_after
    artifacts:
        <<: *batch_artifacts

test:testing-cypress-batch-4:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: django-server testing-cypress
        OVERWRITE_COMPOSE: $DOCKER_DIR/overwrite/testing-cypress.yml $DOCKER_DIR/overwrite/testing-cypress-batch-4.yml
    after_script: *batch_after
    artifacts:
        <<: *batch_artifacts

test:testing-pdf-compilation:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: django-server postgres rabbitmq celery-worker testing-cypress
        OVERWRITE_COMPOSE: $DOCKER_DIR/overwrite/a-dev.yml $DOCKER_DIR/overwrite/testing-pdf-compilation.yml
    after_script:
        # copying makes the folderstructure look nicer on gitlab
        - mkdir $CI_PROJECT_DIR/screenshots
        - mkdir $CI_PROJECT_DIR/pdfs
        - cp -r $CI_PROJECT_DIR/e2e/cypress/pdfs/* $CI_PROJECT_DIR/pdfs
        - cp -r $CI_PROJECT_DIR/e2e/cypress/screenshots/* $CI_PROJECT_DIR/screenshots
    artifacts:
        when: always
        paths:
            - $CI_PROJECT_DIR/screenshots
            - $CI_PROJECT_DIR/pdfs
        reports:
            junit: $CI_PROJECT_DIR/e2e/cypress/reports/*.xml
