test:pre_commit:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: pre_commit
        OVERWRITE_COMPOSE: docker/overwrite/pre_commit_diff.yml

test:django_server:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: django_server
        OVERWRITE_COMPOSE: docker/overwrite/django_server_test.yml
    artifacts:
        reports:
            junit: unittest_reports/*.xml

test:testing_cypress_batch_1:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: django_server testing_cypress
        OVERWRITE_COMPOSE: docker/overwrite/testing_cypress_test_batch_1.yml
    after_script:
        # copying makes the folderstructure look nicer on gitlab
        - mkdir $CI_PROJECT_DIR/videos
        - mkdir $CI_PROJECT_DIR/screenshots
        - cp e2e/cypress/videos/* $CI_PROJECT_DIR/videos
        - cp e2e/cypress/screenshots/* $CI_PROJECT_DIR/screenshots
    artifacts:
        paths:
            - $CI_PROJECT_DIR/videos
            - $CI_PROJECT_DIR/screenshots
        reports:
            junit: e2e/cypress/reports/*.xml

test:testing_cypress_batch_2:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: django_server testing_cypress
        OVERWRITE_COMPOSE: docker/overwrite/testing_cypress_test_batch_2.yml
    after_script:
        # copying makes the folderstructure look nicer on gitlab
        - mkdir $CI_PROJECT_DIR/videos
        - mkdir $CI_PROJECT_DIR/screenshots
        - cp e2e/cypress/videos/* $CI_PROJECT_DIR/videos
        - cp e2e/cypress/screenshots/* $CI_PROJECT_DIR/screenshots
    artifacts:
        paths:
            - $CI_PROJECT_DIR/videos
            - $CI_PROJECT_DIR/screenshots
        reports:
            junit: e2e/cypress/reports/*.xml

test:docker_dev_setup:
    extends: .test:pull_and_run
    variables:
        ALL_SERVICE_NAME: django_server postgres rabbitmq celery_worker
        OVERWRITE_COMPOSE: docker/overwrite/dev.yml docker/overwrite/dev_test.yml
