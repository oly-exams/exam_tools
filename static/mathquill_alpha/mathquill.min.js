/*! mathquill 2015-04-19 */
!function(a){function b(){}function c(b,c,d,e){if(arguments.length){var f=this;f.cmd=b,c&&(f.html_template=c),d&&(f.text_template=d),f.jQ=a(f.html_template[0]).data(O,{cmd:f}),f.initBlocks(e)}}function d(a,b,d){c.call(this,a,[b],[d||(a&&a.length>1?a.slice(1):a)])}function e(){}function f(b,c,d){if(arguments.length){var e=this;e.parent=b,e.prev=c||0,e.next=d||0,e.jQinit(e.fold(a(),function(a,b){return b.jQ.add(a)}))}}function g(b,c,d,e,f){function g(){var a=n.val();a&&(n.val(""),m.parent.textInput(a))}function i(b){return m.seek(a(b.target),b.pageX,b.pageY),m.prev===p.prev&&m.parent===p.parent?m.clearSelection():m.selectFrom(p),!1}function j(a){return delete a.target,i(a)}function k(c){p=N,m.blink=q,m.selection||m.show(),b.unbind("mousemove",i),a(document).unbind("mousemove",j).unbind("mouseup",k)}var l=b.contents().detach();d||b.addClass("mathquill-rendered-math"),c.jQ=b.data(O,{block:c,revert:function(){b.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox mathquill-editor").append(l)}});var m=c.cursor=new K(c);if(c.renderLatex(l.text()),e){c.textarea=a('<span class="textarea"><textarea></textarea></span>').prependTo(b.addClass("mathquill-editable"));var n=c.textarea.children();d&&b.addClass("mathquill-textbox"),f&&h(c,b),n.focus(function(a){m.parent||m.appendTo(c),m.parent.jQ.addClass("hasCursor"),m.selection?m.selection.jQ.removeClass("blur"):m.show(),a.stopPropagation()}).blur(function(a){m.hide().parent.blur(),m.selection&&m.selection.jQ.addClass("blur"),a.stopPropagation()}).bind("selectstart",function(a){a.stopPropagation()});var o={};b.bind("focus.mathquill blur.mathquill",function(a){n.trigger(a)}).bind("keydown.mathquill",function(a){return o.evt=a,o.happened=!0,o.returnValue=m.parent.keydown(a),o.returnValue?!0:(a.stopImmediatePropagation(),!1)}).bind("keypress.mathquill",function(a){return o.happened?o.happened=!1:o.returnValue=m.parent.keydown(o.evt),o.returnValue?void setTimeout(g):!1}).bind("mousedown.mathquill",function(d){m.seek(a(d.target),d.pageX,d.pageY).blink=a.noop,p=new K(c),p.jQ=p._jQ=a(),m.next?p.insertBefore(m.next):p.appendTo(m.parent),b.mousemove(i),a(document).mousemove(j).mouseup(k),setTimeout(function(){n.focus()})}).bind("selectstart.mathquill",!1).blur();var p,q=m.blink}}function h(b,c){var d=[{name:"Basic",example:"+",button_groups:[["subscript","supscript","frac","sqrt","nthroot","langle","binomial","vector","f","prime"],["+","-","pm","mp","cdot","=","times","div","ast"],["therefore","because"],["sum","prod","coprod","int"],["N","P","Z","Q","R","C","H"]]},{name:"Greek",example:"&pi;",button_groups:[["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"],["digamma","varepsilon","vartheta","varkappa","varpi","varrho","varsigma","varphi"],["Gamma","Delta","Theta","Lambda","Xi","Pi","Sigma","Upsilon","Phi","Psi","Omega"]]},{name:"Operators",example:"&oplus;",button_groups:[["wedge","vee","cup","cap","diamond","bigtriangleup","ominus","uplus","otimes","oplus","bigtriangledown","sqcap","triangleleft","sqcup","triangleright","odot","bigcirc","dagger","ddagger","wr","amalg"]]},{name:"Relationships",example:"&le;",button_groups:[["<",">","equiv","cong","sim","notin","ne","propto","approx","le","ge","in","ni","notni","subset","supset","notsubset","notsupset","subseteq","supseteq","notsubseteq","notsupseteq","models","prec","succ","preceq","succeq","simeq","mid","ll","gg","parallel","bowtie","sqsubset","sqsupset","smile","sqsubseteq","sqsupseteq","doteq","frown","vdash","dashv","exists","varnothing"]]},{name:"Arrows",example:"&hArr;",button_groups:[["longleftarrow","longrightarrow","Longleftarrow","Longrightarrow","longleftrightarrow","updownarrow","Longleftrightarrow","Updownarrow","mapsto","nearrow","hookleftarrow","hookrightarrow","searrow","leftharpoonup","rightharpoonup","swarrow","leftharpoondown","rightharpoondown","nwarrow","downarrow","Downarrow","uparrow","Uparrow","rightarrow","Rightarrow","leftarrow","lArr","leftrightarrow","Leftrightarrow"]]},{name:"Delimiters",example:"{",button_groups:[["lfloor","rfloor","lceil","rceil","slash","opencurlybrace","closecurlybrace"]]},{name:"Misc",example:"&infin;",button_groups:[["forall","ldots","cdots","vdots","ddots","surd","triangle","ell","top","flat","natural","sharp","wp","bot","clubsuit","diamondsuit","heartsuit","spadesuit","caret","underscore","backslash","vert","perp","nabla","hbar","AA","circ","bullet","setminus","neg","dots","Re","Im","partial","infty","aleph","deg","angle"]]}],e={binomial:'<span style="font-size: 0.5em"><span class="paren" style="font-size: 2.087912087912088em; ">(</span><span class="array"><span><var>n</var></span><span><var>m</var></span></span><span class="paren" style="font-size: 2.087912087912088em; ">)</span></span>',frac:'<span style="font-size: 0.55em" class="fraction"><span class="numerator"><var>n</var></span><span class="denominator"><var>m</var></span><span style="width:0"></span></span>',sqrt:'<span style="font-size: 0.8em; padding-top: 3px"><span class="sqrt-prefix">&radic;</span><span class="sqrt-stem" style="border-top-width: 1.7142857142857144px;">&nbsp;</span></span>',nthroot:'<span style="font-size: 0.7em"><sup class="nthroot"><var>n</var></sup><span><span class="sqrt-prefix">&radic;</span><span class="sqrt-stem" style="border-top-width: 1.7142857142857144px; ">&nbsp;</span></span></span>',supscript:'<sup style="font-size: 0.6em">sup</sup>',subscript:'<sub style="font-size: 0.6em; line-height: 3.5;">sub</sub>',vector:'<span class="array" style="font-size: 0.6em"><span class=""><var>a</var><span> </span><var>b</var></span><span class=""><var>c</var><span> </span><var>d</var></span></span>'},f=[],g=[];a.each(d,function(b,c){f.push('<li><a href="#'+c.name+'_tab"><span class="mathquill-rendered-math">'+c.example+"</span>"+c.name+"</a></li>");var d=[];a.each(c.button_groups,function(b,c){a.each(c,function(a,b){var c=new Q[b](N,b);d.push('<li><a class="mathquill-rendered-math" title="'+(b.match(/^[a-z]+$/)?"\\"+b:b)+'">'+(e[b]?e[b]:'<span style="line-height: 1.5em">'+c.html_template.join("")+"</span>")+"</a></li>")}),d.push('<li class="mathquill-button-spacer"></li>')}),g.push('<div class="mathquill-tab-pane" id="'+c.name+'_tab"><ul>'+d.join("")+"</ul></div>")}),b.toolbar=a('<div class="mathquill-toolbar"><ul class="mathquill-tab-bar">'+f.join("")+'</ul><div class="mathquill-toolbar-panes">'+g.join("")+"</div></div>").prependTo(c),c.find(".mathquill-tab-bar li a").mouseenter(function(){c.find(".mathquill-tab-bar li").removeClass("mathquill-tab-selected"),c.find(".mathquill-tab-pane").removeClass("mathquill-tab-pane-selected"),a(this).parent().addClass("mathquill-tab-selected"),a(this.href.replace(/.*#/,"#")).addClass("mathquill-tab-pane-selected")}),c.find(".mathquill-tab-bar li:first-child a").mouseenter(),c.find("a.mathquill-rendered-math").mousedown(function(a){a.stopPropagation()}).click(function(){b.cursor.writeLatex(this.title,!0),c.focus()})}function i(){}function j(a){c.call(this,"$"),this.firstChild.cursor=a,this.firstChild.textInput=function(b){this.skipTextInput||("$"!==b||a.parent!==this?a.write(b):this.isEmpty()?a.insertAfter(this.parent).backspace().insertNew(new E("\\$","$")).show():a.next?a.prev?a.write(b):a.insertBefore(this.parent):a.insertAfter(this.parent))}}function k(){}function l(a,b){return b.prototype=a.prototype,b}function m(a,b,d,e){c.call(this,a,[b],[d],e)}function n(a){c.call(this,"\\frac",N,N,a),this.jQ.append('<span style="width:0">&nbsp;</span>')}function o(){n.apply(this,arguments)}function p(a){c.call(this,"\\sqrt",N,N,a)}function q(a){p.call(this,a),this.jQ=this.firstChild.jQ.detach().add(this.jQ)}function r(a,b,d,e,f){c.call(this,d,['<span><span class="paren">'+a+'</span><span></span><span class="paren">'+b+"</span></span>"],[a,b],f),this.end=e}function s(a,b,c,d,e){r.apply(this,arguments)}function t(a,b,c){r.call(this,a,b,a,b,c)}function u(a,b,c){s.call(this,a,b,a,b,c)}function v(a){t.call(this,"|","|",a)}function w(a){a instanceof f?this.replacedText=a.remove().jQ.text():"string"==typeof a&&(this.replacedText=a),c.call(this,"\\text")}function x(){}function y(a){c.call(this,"\\"),a&&(this.replacedFragment=a.detach(),this.isEmpty=function(){return!1})}function z(a){c.call(this,"\\binom",N,N,a),this.jQ.wrapInner('<span class="array"></span>').prepend('<span class="paren">(</span>').append('<span class="paren">)</span>')}function A(){z.apply(this,arguments)}function B(a){c.call(this,"\\vector",N,N,a)}function C(a){var b=Array.prototype.slice.call(arguments,1);return l(a,function(){a.apply(this,b)})}function D(a,b){d.call(this,a,"<var>"+(b||a)+"</var>")}function E(a,b){d.call(this,a,"<span>"+(b||a)+"</span>")}function F(a,b){d.call(this,a,'<span class="nonSymbola">'+(b||a)+"</span>")}function G(a,b,c){d.call(this,a,'<span class="binary-operator">'+b+"</span>",c)}function H(a,b){E.apply(this,arguments)}function I(a,b){d.call(this,a,"<big>"+b+"</big>")}function J(a,b){d.call(this,"\\"+b+" ","<span>"+b+"</span>")}function K(b){this.parent=this.root=b;var c=this.jQ=this._jQ=a('<span class="cursor"></span>');this.blink=function(){c.toggleClass("blink")}}function L(a,b,c){f.apply(this,arguments)}var M,N,O="[[mathquill internal data]]";M=b.prototype,M.prev=0,M.next=0,M.parent=0,M.firstChild=0,M.lastChild=0,M.eachChild=function(a){for(var b=this.firstChild;b&&a.call(this,b)!==!1;b=b.next);return this},M.foldChildren=function(a,b){return this.eachChild(function(c){a=b.call(this,a,c)}),a},M.keydown=function(a){return this.parent.keydown(a)},M.textInput=function(a){return this.parent.textInput(a)},M=c.prototype=new b,M.initBlocks=function(b){var c=this;if(1===c.html_template.length)return c.firstChild=c.lastChild=c.jQ.data(O).block=b&&b.blockify()||new e,c.firstChild.parent=c,void(c.firstChild.jQ=c.jQ.append(c.firstChild.jQ));var d,f,g=c.html_template.length;this.firstChild=d=f=b&&b.blockify()||new e,d.parent=c,d.jQ=a(c.html_template[1]).data(O,{block:d}).append(d.jQ).appendTo(c.jQ),d.blur();for(var h=2;g>h;h+=1)d=new e,d.parent=c,d.prev=f,f.next=d,f=d,d.jQ=a(c.html_template[h]).data(O,{block:d}).appendTo(c.jQ),d.blur();c.lastChild=d},M.latex=function(){return this.foldChildren(this.cmd,function(a,b){return a+"{"+(b.latex()||" ")+"}"})},M.text=function(){var a=0;return this.foldChildren(this.text_template[a],function(b,c){a+=1;var d=c.text();return b&&"("===this.text_template[a]&&"("===d[0]&&")"===d.slice(-1)?b+d.slice(1,-1)+this.text_template[a]:b+c.text()+(this.text_template[a]||"")})},M.remove=function(){var a=this,b=a.prev,c=a.next,d=a.parent;return b?b.next=c:d.firstChild=c,c?c.prev=b:d.lastChild=b,a.jQ.remove(),a},M.respace=a.noop,M.placeCursor=function(a){a.appendTo(this.foldChildren(this.firstChild,function(a,b){return a.isEmpty()?a:b}))},M.isEmpty=function(){return this.foldChildren(!0,function(a,b){return a&&b.isEmpty()})},M=d.prototype=new c,M.initBlocks=a.noop,M.latex=function(){return this.cmd},M.text=function(){return this.text_template},M.placeCursor=a.noop,M.isEmpty=function(){return!0},M=e.prototype=new b,M.latex=function(){return this.foldChildren("",function(a,b){return a+b.latex()})},M.text=function(){return this.firstChild===this.lastChild?this.firstChild.text():this.foldChildren("(",function(a,b){return a+b.text()})+")"},M.isEmpty=function(){return 0===this.firstChild&&0===this.lastChild},M.focus=function(){return this.jQ.addClass("hasCursor"),this.isEmpty()&&this.jQ.removeClass("empty"),this},M.blur=function(){return this.jQ.removeClass("hasCursor"),this.isEmpty()&&this.jQ.addClass("empty"),this},M=f.prototype,M.remove=c.prototype.remove,M.jQinit=function(a){this.jQ=a},M.each=function(a){for(var b=this.prev.next||this.parent.firstChild;b!==this.next&&a.call(this,b)!==!1;b=b.next);return this},M.fold=function(a,b){return this.each(function(c){a=b.call(this,a,c)}),a},M.latex=function(){return this.fold("",function(a,b){return a+b.latex()})},M.blockify=function(){var a=this,b=a.prev,c=a.next,d=a.parent,f=new e,g=f.firstChild=b.next||d.firstChild,h=f.lastChild=c.prev||d.lastChild;return b?b.next=c:d.firstChild=c,c?c.prev=b:d.lastChild=b,g.prev=a.prev=0,h.next=a.next=0,a.parent=f,a.each(function(a){a.parent=f}),f.jQ=a.jQ,f},M=i.prototype=new e,M.latex=function(){return e.prototype.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},M.text=function(){return this.foldChildren("",function(a,b){return a+b.text()})},M.renderLatex=function(a){this.jQ.children().slice(1).remove(),this.firstChild=this.lastChild=0,this.cursor.appendTo(this).writeLatex(a),this.blur()},M.keydown=function(a){switch(this.skipTextInput=!0,a.ctrlKey=a.ctrlKey||a.metaKey,a.originalEvent&&a.originalEvent.keyIdentifier||a.which){case 8:case"Backspace":case"U+0008":if(a.ctrlKey)for(;this.cursor.prev||this.cursor.selection;)this.cursor.backspace();else this.cursor.backspace();break;case 27:case"Esc":case"U+001B":case 9:case"Tab":case"U+0009":if(a.ctrlKey)break;var b=this.cursor.parent;if(a.shiftKey){if(b===this)break;b.prev?this.cursor.appendTo(b.prev):this.cursor.insertBefore(b.parent)}else{if(b===this)return this.skipTextInput=!0;b.next?this.cursor.prependTo(b.next):this.cursor.insertAfter(b.parent)}return this.cursor.clearSelection(),!1;case 13:case"Enter":a.preventDefault();break;case 35:case"End":if(a.shiftKey)for(;this.cursor.next||a.ctrlKey&&this.cursor.parent!==this;)this.cursor.selectRight();else this.cursor.clearSelection().appendTo(a.ctrlKey?this:this.cursor.parent);return a.preventDefault(),!1;case 36:case"Home":if(a.shiftKey)for(;this.cursor.prev||a.ctrlKey&&this.cursor.parent!==this;)this.cursor.selectLeft();else this.cursor.clearSelection().prependTo(a.ctrlKey?this:this.cursor.parent);return a.preventDefault(),!1;case 37:case"Left":if(a.ctrlKey)break;return a.shiftKey?this.cursor.selectLeft():this.cursor.moveLeft(),a.preventDefault(),!1;case 38:case"Up":if(a.ctrlKey)break;if(a.shiftKey)if(this.cursor.prev)for(;this.cursor.prev;)this.cursor.selectLeft();else this.cursor.selectLeft();else this.cursor.parent.prev?this.cursor.clearSelection().appendTo(this.cursor.parent.prev):this.cursor.prev?this.cursor.clearSelection().prependTo(this.cursor.parent):this.cursor.parent!==this&&this.cursor.clearSelection().insertBefore(this.cursor.parent.parent);return a.preventDefault(),!1;case 39:case"Right":if(a.ctrlKey)break;return a.shiftKey?this.cursor.selectRight():this.cursor.moveRight(),a.preventDefault(),!1;case 40:case"Down":if(a.ctrlKey)break;if(a.shiftKey)if(this.cursor.next)for(;this.cursor.next;)this.cursor.selectRight();else this.cursor.selectRight();else this.cursor.parent.next?this.cursor.clearSelection().prependTo(this.cursor.parent.next):this.cursor.next?this.cursor.clearSelection().appendTo(this.cursor.parent):this.cursor.parent!==this&&this.cursor.clearSelection().insertAfter(this.cursor.parent.parent);return a.preventDefault(),!1;case 46:case"Del":case"U+007F":if(a.ctrlKey)for(;this.cursor.next||this.cursor.selection;)this.cursor.deleteForward();else this.cursor.deleteForward();break;case 65:case"A":case"U+0041":if(a.ctrlKey&&!a.shiftKey&&!a.altKey){if(this!==this.cursor.root)return this.parent.keydown(a);for(this.cursor.clearSelection().appendTo(this);this.cursor.prev;)this.cursor.selectLeft();return a.preventDefault(),!1}this.skipTextInput=!1;break;case 67:case"C":case"U+0043":if(!a.ctrlKey||a.shiftKey||a.altKey)this.skipTextInput=!1;else{if(this!==this.cursor.root)return this.parent.keydown(a);if(!this.cursor.selection)return!0}break;case 86:case"V":case"U+0056":if(!a.ctrlKey||a.shiftKey||a.altKey)this.skipTextInput=!1;else{if(this!==this.cursor.root)return this.parent.keydown(a);var c=this;setTimeout(function(){c.cursor.writeLatex(c.cursor.root.textarea.children().val()),c.cursor.clearSelection()})}break;case 88:case"X":case"U+0058":if(!a.ctrlKey||a.shiftKey||a.altKey)this.skipTextInput=!1;else{if(this!==this.cursor.root)return this.parent.keydown(a);if(!this.cursor.selection)return!0;this.cursor.deleteSelection()}break;default:this.skipTextInput=!1}return!0},M.textInput=function(a){this.skipTextInput||this.cursor.write(a)},M=j.prototype=new c,M.html_template=['<span class="mathquill-rendered-math"></span>'],M.initBlocks=function(){this.firstChild=this.lastChild=this.jQ.data(O).block=new i,this.firstChild.parent=this,this.firstChild.jQ=this.jQ},M=k.prototype=new e,M.renderLatex=function(a){var b=this,c=b.cursor;b.jQ.children().slice(1).remove(),b.firstChild=b.lastChild=0,c.show().appendTo(b),a=a.match(/(?:\\\$|[^$])+|\$(?:\\\$|[^$])*\$|\$(?:\\\$|[^$])*$/g)||"";for(var d=0;d<a.length;d+=1){var e=a[d];if("$"===e[0]){e="$"===e[-1+e.length]&&"\\"!==e[-2+e.length]?e.slice(1,-1):e.slice(1);var f=new j(c);c.insertNew(f),f.firstChild.renderLatex(e),c.show().insertAfter(f)}else for(var g=0;g<e.length;g+=1)this.cursor.insertNew(new E(e[g]))}},M.keydown=i.prototype.keydown,M.textInput=function(a){this.skipTextInput||(this.cursor.deleteSelection(),this.cursor.insertNew("$"===a?new j(this.cursor):new E(a)))};var P={},Q={};M=m.prototype=new c,M.latex=function(){var a=this.firstChild.latex();return 1===a.length?this.cmd+a:this.cmd+"{"+(a||" ")+"}"},M.redraw=function(){this.respace(),this.next&&this.next.respace(),this.prev&&this.prev.respace()},M.respace=function(){return"\\int "===this.prev.cmd||this.prev instanceof m&&this.prev.cmd!=this.cmd&&this.prev.prev&&"\\int "===this.prev.prev.cmd?this.limit||(this.limit=!0,this.jQ.addClass("limit")):this.limit&&(this.limit=!1,this.jQ.removeClass("limit")),this.jQ.css((this.respaced=this.prev instanceof m&&this.prev.cmd!=this.cmd&&!this.prev.respaced)?this.limit&&"_"===this.cmd?{left:-.25-this.prev.jQ.outerWidth()/+this.jQ.css("fontSize").slice(0,-2)+"em",marginRight:.1-Math.min(this.jQ.outerWidth(),this.prev.jQ.outerWidth())/+this.jQ.css("fontSize").slice(0,-2)+"em"}:{left:-this.prev.jQ.outerWidth()/+this.jQ.css("fontSize").slice(0,-2)+"em",marginRight:.1-Math.min(this.jQ.outerWidth(),this.prev.jQ.outerWidth())/+this.jQ.css("fontSize").slice(0,-2)+"em"}:this.limit&&"_"===this.cmd?{left:"-.25em",marginRight:""}:{left:"",marginRight:""}),this},Q.subscript=Q._=l(m,function(a){m.call(this,"_","<sub></sub>","_",a)}),Q.superscript=Q.supscript=Q["^"]=l(m,function(a){m.call(this,"^","<sup></sup>","**",a)}),M=n.prototype=new c,M.html_template=['<span class="fraction"></span>','<span class="numerator"></span>','<span class="denominator"></span>'],M.text_template=["(","/",")"],Q.frac=Q.fraction=n,M=o.prototype=new n,M.placeCursor=function(a){if(this.firstChild.isEmpty()){for(var b=this.prev;b&&!(b instanceof G||b instanceof w||b instanceof I);)b=b.prev;if(b instanceof I&&b.next instanceof m&&(b=b.next,b.next instanceof m&&b.next.cmd!=b.cmd&&(b=b.next)),b!==this.prev){var c=new f(this.parent,b,this).blockify();c.jQ=this.firstChild.jQ.empty().removeClass("empty").append(c.jQ).data(O,{block:c}),c.next=this.lastChild,c.parent=this,this.firstChild=this.lastChild.prev=c}}a.appendTo(this.lastChild)},P["/"]=o,M=p.prototype=new c,M.html_template=['<span><span class="sqrt-prefix">&radic;</span></span>','<span class="sqrt-stem"></span>'],M.text_template=["sqrt(",")"],M.redraw=function(){var a=this.lastChild.jQ,b=a.outerHeight(!0);a.css({borderTopWidth:b/28+1}).prev().css({fontSize:.9*b/+a.css("fontSize").slice(0,-2)+"em"})},M.optional_arg_command="nthroot",Q.sqrt=Q["√"]=p,M=q.prototype=new p,M.html_template=['<span><span class="sqrt-prefix">&radic;</span></span>','<sup class="nthroot"></sup>','<span class="sqrt-stem"></span>'],M.text_template=["sqrt[","](",")"],M.latex=function(){return"\\sqrt["+this.firstChild.latex()+"]{"+this.lastChild.latex()+"}"},Q.nthroot=q,M=r.prototype=new c,M.initBlocks=function(a){this.firstChild=this.lastChild=a&&a.blockify()||new e,this.firstChild.parent=this,this.firstChild.jQ=this.jQ.children(":eq(1)").data(O,{block:this.firstChild}).append(this.firstChild.jQ)},M.latex=function(){return this.cmd+this.firstChild.latex()+this.end},M.redraw=function(){var a=this.firstChild.jQ;a.prev().add(a.next()).css("fontSize",a.outerHeight()/(1.02*+a.css("fontSize").slice(0,-2))+"em")},Q.lbrace=P["{"]=l(r,function(a){r.call(this,"{","}","\\{","\\}",a)}),Q.langle=Q.lang=l(r,function(a){r.call(this,"&lang;","&rang;","\\langle ","\\rangle ",a)}),Q.lbrack=Q.lbracket=P["["]=l(r,function(a){r.call(this,"[","]","\\[","\\]",a)}),M=s.prototype=new r,M.placeCursor=function(a){!this.next&&this.parent.parent&&this.parent.parent.end===this.end&&this.firstChild.isEmpty()?a.backspace().insertAfter(this.parent.parent):this.firstChild.blur()},Q.rbrace=P["}"]=l(s,function(a){s.call(this,"{","}","\\{","\\}",a)}),Q.rangle=Q.rang=l(s,function(a){s.call(this,"&lang;","&rang;","\\langle ","\\rangle ",a)}),Q.rbrack=Q.rbracket=P["]"]=l(s,function(a){s.call(this,"[","]","\\[","\\]",a)}),t.prototype=r.prototype,Q.lparen=P["("]=l(t,function(a){t.call(this,"(",")",a)}),u.prototype=s.prototype,Q.rparen=P[")"]=l(u,function(a){u.call(this,"(",")",a)}),M=v.prototype=new t,M.placeCursor=function(a){!this.next&&this.parent.parent&&this.parent.parent.end===this.end&&this.firstChild.isEmpty()?a.backspace().insertAfter(this.parent.parent):a.appendTo(this.firstChild)},Q.lpipe=Q.rpipe=P["|"]=v,M=w.prototype=new c,M.html_template=['<span class="text"></span>'],M.text_template=['"','"'],M.initBlocks=function(){this.firstChild=this.lastChild=this.jQ.data(O).block=new x,this.firstChild.parent=this,this.firstChild.jQ=this.jQ.append(this.firstChild.jQ)},M.placeCursor=function(a){if((this.cursor=a).appendTo(this.firstChild),this.replacedText)for(var b=0;b<this.replacedText.length;b+=1)this.write(this.replacedText.charAt(b))},M.write=function(a){this.cursor.insertNew(new E(a))},M.keydown=function(a){return this.cursor.selection||(8!==a.which||this.cursor.prev)&&(46!==a.which||this.cursor.next)?this.parent.keydown(a):(this.isEmpty()&&this.cursor.insertAfter(this),!1)},M.textInput=function(a){if(this.cursor.deleteSelection(),"$"!==a)this.write(a);else if(this.isEmpty())this.cursor.insertAfter(this).backspace().insertNew(new E("\\$","$"));else if(this.cursor.next)if(this.cursor.prev){var b=new w(new f(this.firstChild,this.cursor.prev));b.placeCursor=function(a){this.prev=0,delete this.placeCursor,this.placeCursor(a)},b.firstChild.focus=function(){return this},this.cursor.insertAfter(this).insertNew(b),b.prev=this,this.cursor.insertBefore(b),delete b.firstChild.focus}else this.cursor.insertBefore(this);else this.cursor.insertAfter(this)},M=x.prototype=new e,M.blur=function(){if(this.jQ.removeClass("hasCursor"),this.isEmpty()){var a=this.parent,b=a.cursor;b.parent===this?this.jQ.addClass("empty"):(b.hide(),a.remove(),b.next===a?b.next=a.next:b.prev===a&&(b.prev=a.prev),b.show().redraw())}return this},M.focus=function(){e.prototype.focus.call(this);var a=this.parent;if(a.next instanceof w){var b=this,c=a.cursor,d=a.next.firstChild;d.eachChild(function(a){a.parent=b,a.jQ.appendTo(b.jQ)}),this.lastChild?this.lastChild.next=d.firstChild:this.firstChild=d.firstChild,d.firstChild.prev=this.lastChild,this.lastChild=d.lastChild,d.parent.remove(),c.prev?c.insertAfter(c.prev):c.prependTo(this),c.redraw()}else if(a.prev instanceof w){var c=a.cursor;c.prev?a.prev.firstChild.focus():c.appendTo(a.prev.firstChild)}return this},Q.text=P.$=w,M=y.prototype=new c,M.html_template=['<span class="latex-command-input"></span>'],M.text_template=["\\"],M.placeCursor=function(b){this.cursor=b.appendTo(this.firstChild),this.replacedFragment&&(this.jQ=this.jQ.add(this.replacedFragment.jQ.addClass("blur").bind("mousedown mousemove",function(b){return a(b.target=this.nextSibling).trigger(b),!1}).insertBefore(this.jQ)))},M.latex=function(){return"\\"+this.firstChild.latex()+" "},M.keydown=function(a){return 9===a.which||13===a.which?(this.renderCommand(),!1):this.parent.keydown(a)},M.textInput=function(a){return a.match(/[a-z]/i)?(this.cursor.deleteSelection(),void this.cursor.insertNew(new E(a))):(this.renderCommand(),void(" "===a||"\\"===a&&this.firstChild.isEmpty()||this.cursor.parent.textInput(a)))},M.renderCommand=function(){this.jQ=this.jQ.last(),this.remove(),this.next?this.cursor.insertBefore(this.next):this.cursor.appendTo(this.parent);var a,b=this.firstChild.latex();if(b){if(!(a=Q[b]))return a=new w(b),a.firstChild.focus=function(){return delete this.focus,this},this.cursor.insertNew(a).insertAfter(a),void(this.replacedFragment&&this.replacedFragment.remove());a=new a(this.replacedFragment,b)}else a=new E("\\backslash ","\\");this.cursor.insertNew(a),a instanceof d&&this.replacedFragment&&this.replacedFragment.remove()},P["\\"]=y,M=z.prototype=new c,M.html_template=["<span></span>","<span></span>","<span></span>"],M.text_template=["choose(",",",")"],M.redraw=function(){this.jQ.children(":first").add(this.jQ.children(":last")).css("fontSize",this.jQ.outerHeight()/(.9*+this.jQ.css("fontSize").slice(0,-2)+2)+"em")},Q.binom=Q.binomial=z,M=A.prototype=new z,M.placeCursor=o.prototype.placeCursor,Q.choose=A,M=B.prototype=new c,M.html_template=['<span class="array"></span>',"<span></span>"],M.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(a,b){return a.push(b.latex()),a}).join("\\\\")+"\\end{matrix}"},M.text=function(){return"["+this.foldChildren([],function(a,b){return text.push(b.text()),text}).join()+"]"},M.placeCursor=function(a){this.cursor=a.appendTo(this.firstChild)},M.keydown=function(b){var c=this.cursor.parent;if(c.parent===this){if(13===b.which){var d=new e;return d.parent=this,d.jQ=a("<span></span>").data(O,{block:d}).insertAfter(c.jQ),c.next?c.next.prev=d:this.lastChild=d,d.next=c.next,c.next=d,d.prev=c,this.cursor.appendTo(d).redraw(),!1}if(9===b.which&&!b.shiftKey&&!c.next){if(c.isEmpty())return c.prev?(this.cursor.insertAfter(this),delete c.prev.next,this.lastChild=c.prev,c.jQ.remove(),this.cursor.redraw(),!1):this.parent.keydown(b);var d=new e;return d.parent=this,d.jQ=a("<span></span>").data(O,{block:d}).appendTo(this.jQ),this.lastChild=d,c.next=d,d.prev=c,this.cursor.appendTo(d).redraw(),!1}if(8===b.which){if(c.isEmpty())return c.prev?(this.cursor.appendTo(c.prev),c.prev.next=c.next):(this.cursor.insertBefore(this),this.firstChild=c.next),c.next?c.next.prev=c.prev:this.lastChild=c.prev,c.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.cursor.redraw(),!1;if(!this.cursor.prev)return!1}}return this.parent.keydown(b)},Q.vector=B,Q.editable=l(j,function(){c.call(this,"\\editable"),g(this.jQ,this.firstChild,!1,!0);var a;this.placeCursor=function(b){a=b.appendTo(this.firstChild)},this.firstChild.blur=function(){a.prev===this.parent&&(delete this.blur,this.cursor.appendTo(this),e.prototype.blur.call(this))},this.text=function(){return this.firstChild.text()}}),Q.f=C(d,"f",'<var class="florin">&fnof;</var>'),M=D.prototype=new d,M.text=function(){var a=this.cmd;return!this.prev||this.prev instanceof D||this.prev instanceof G||(a="*"+a),!this.next||this.next instanceof G||"^"===this.next.cmd||(a+="*"),a},E.prototype=d.prototype,P[" "]=C(E,"\\:"," "),Q.prime=P["'"]=C(E,"'","&prime;"),F.prototype=d.prototype,Q["@"]=F,Q["&"]=C(F,"\\&","&"),Q["%"]=C(F,"\\%","%"),Q.alpha=Q.beta=Q.gamma=Q.delta=Q.zeta=Q.eta=Q.theta=Q.iota=Q.kappa=Q.mu=Q.nu=Q.xi=Q.rho=Q.sigma=Q.tau=Q.chi=Q.psi=Q.omega=l(d,function(a,b){D.call(this,"\\"+b+" ","&"+b+";")}),Q.phi=C(D,"\\phi ","&#981;"),Q.phiv=Q.varphi=C(D,"\\varphi ","&phi;"),Q.epsilon=C(D,"\\epsilon ","&#1013;"),Q.epsiv=Q.varepsilon=C(D,"\\varepsilon ","&epsilon;"),Q.sigmaf=Q.sigmav=Q.varsigma=C(D,"\\varsigma ","&sigmaf;"),Q.upsilon=Q.upsi=C(D,"\\upsilon ","&upsilon;"),Q.gammad=Q.Gammad=Q.digamma=C(D,"\\digamma ","&#989;"),Q.kappav=Q.varkappa=C(D,"\\varkappa ","&#1008;"),Q.piv=Q.varpi=C(D,"\\varpi ","&#982;"),Q.rhov=Q.varrho=C(D,"\\varrho ","&#1009;"),Q.thetav=Q.vartheta=C(D,"\\vartheta ","&#977;"),Q.pi=Q["π"]=C(F,"\\pi ","&pi;"),Q.lambda=C(F,"\\lambda ","&lambda;"),Q.Upsilon=Q.Upsi=C(D,"\\Upsilon ","&Upsilon;"),Q.Gamma=Q.Delta=Q.Theta=Q.Lambda=Q.Xi=Q.Pi=Q.Sigma=Q.Phi=Q.Psi=Q.Omega=Q.forall=l(d,function(a,b){E.call(this,"\\"+b+" ","&"+b+";")}),G.prototype=new d,M=H.prototype=new G,M.respace=function(){return this.prev?this.prev instanceof G&&this.next&&!(this.next instanceof G)?this.jQ[0].className="unary-operator":this.jQ[0].className="binary-operator":this.jQ[0].className="",this},Q["+"]=C(H,"+"),Q["-"]=C(H,"-","&minus;"),Q.pm=Q.plusmn=Q.plusminus=C(H,"\\pm ","&plusmn;"),Q.mp=Q.mnplus=Q.minusplus=C(H,"\\mp ","&#8723;"),P["*"]=Q.sdot=Q.cdot=C(G,"\\cdot ","&middot;"),Q["="]=C(G,"=","="),Q["<"]=C(G,"<","&lt;"),Q[">"]=C(G,">","&gt;"),Q.notin=Q.sim=Q.cong=Q.equiv=Q.oplus=Q.otimes=l(G,function(a,b){G.call(this,"\\"+b+" ","&"+b+";")}),Q.times=l(G,function(a,b){G.call(this,"\\times ","&times;","[x]")}),Q.div=Q.divide=Q.divides=C(G,"\\div ","&divide;","[/]"),Q.ne=Q.neq=C(G,"\\ne ","&ne;"),Q.ast=Q.star=Q.loast=Q.lowast=C(G,"\\ast ","&lowast;"),Q.therefor=Q.therefore=C(G,"\\therefore ","&there4;"),Q.cuz=Q.because=C(G,"\\because ","&#8757;"),Q.prop=Q.propto=C(G,"\\propto ","&prop;"),Q.asymp=Q.approx=C(G,"\\approx ","&asymp;"),Q.lt=C(G,"<","&lt;"),Q.gt=C(G,">","&gt;"),Q.le=Q.leq=C(G,"\\le ","&le;"),Q.ge=Q.geq=C(G,"\\ge ","&ge;"),Q.isin=Q["in"]=C(G,"\\in ","&isin;"),Q.ni=Q.contains=C(G,"\\ni ","&ni;"),Q.notni=Q.niton=Q.notcontains=Q.doesnotcontain=C(G,"\\not\\ni ","&#8716;"),Q.sub=Q.subset=C(G,"\\subset ","&sub;"),Q.sup=Q.supset=Q.superset=C(G,"\\supset ","&sup;"),Q.nsub=Q.notsub=Q.nsubset=Q.notsubset=C(G,"\\not\\subset ","&#8836;"),Q.nsup=Q.notsup=Q.nsupset=Q.notsupset=Q.nsuperset=Q.notsuperset=C(G,"\\not\\supset ","&#8837;"),Q.sube=Q.subeq=Q.subsete=Q.subseteq=C(G,"\\subseteq ","&sube;"),Q.supe=Q.supeq=Q.supsete=Q.supseteq=Q.supersete=Q.superseteq=C(G,"\\supseteq ","&supe;"),Q.nsube=Q.nsubeq=Q.notsube=Q.notsubeq=Q.nsubsete=Q.nsubseteq=Q.notsubsete=Q.notsubseteq=C(G,"\\not\\subseteq ","&#8840;"),Q.nsupe=Q.nsupeq=Q.notsupe=Q.notsupeq=Q.nsupsete=Q.nsupseteq=Q.notsupsete=Q.notsupseteq=Q.nsupersete=Q.nsuperseteq=Q.notsupersete=Q.notsuperseteq=C(G,"\\not\\supseteq ","&#8841;"),I.prototype=new d,Q.sum=Q.summation=C(I,"\\sum ","&sum;"),Q.prod=Q.product=C(I,"\\prod ","&prod;"),Q.coprod=Q.coproduct=C(I,"\\coprod ","&#8720;"),Q["int"]=Q.integral=Q["∫"]=C(I,"\\int ","&int;"),Q.N=Q.naturals=Q.Naturals=C(E,"\\mathbb{N}","&#8469;"),Q.P=Q.primes=Q.Primes=Q.projective=Q.Projective=Q.probability=Q.Probability=C(E,"\\mathbb{P}","&#8473;"),Q.Z=Q.integers=Q.Integers=C(E,"\\mathbb{Z}","&#8484;"),Q.Q=Q.rationals=Q.Rationals=C(E,"\\mathbb{Q}","&#8474;"),Q.R=Q.reals=Q.Reals=C(E,"\\mathbb{R}","&#8477;"),Q.C=Q.complex=Q.Complex=Q.complexes=Q.Complexes=Q.complexplane=Q.Complexplane=Q.ComplexPlane=C(E,"\\mathbb{C}","&#8450;"),Q.H=Q.Hamiltonian=Q.quaternions=Q.Quaternions=C(E,"\\mathbb{H}","&#8461;"),Q.quad=Q.emsp=C(E,"\\quad ","    "),Q.qquad=C(E,"\\qquad ","        "),Q.diamond=C(E,"\\diamond","&#9671;"),Q.bigtriangleup=C(E,"\\bigtriangleup","&#9651;"),Q.ominus=C(E,"\\ominus","&#8854;"),Q.uplus=C(E,"\\uplus","&#8846;"),Q.bigtriangledown=C(E,"\\bigtriangledown","&#9661;"),Q.sqcap=C(E,"\\sqcap","&#8851;"),Q.triangleleft=C(E,"\\triangleleft","&#8882;"),Q.sqcup=C(E,"\\sqcup","&#8852;"),Q.triangleright=C(E,"\\triangleright","&#8883;"),Q.odot=C(E,"\\odot","&#8857;"),Q.bigcirc=C(E,"\\bigcirc","&#9711;"),Q.dagger=C(E,"\\dagger","&#0134;"),Q.ddagger=C(E,"\\ddagger","&#135;"),Q.wr=C(E,"\\wr","&#8768;"),Q.amalg=C(E,"\\amalg","&#8720;"),Q.models=C(E,"\\models","&#8872;"),Q.prec=C(E,"\\prec","&#8826;"),Q.succ=C(E,"\\succ","&#8827;"),Q.preceq=C(E,"\\preceq","&#8828;"),Q.succeq=C(E,"\\succeq","&#8829;"),Q.simeq=C(E,"\\simeq","&#8771;"),Q.mid=C(E,"\\mid","&#8739;"),Q.ll=C(E,"\\ll","&#8810;"),Q.gg=C(E,"\\gg","&#8811;"),Q.parallel=C(E,"\\parallel","&#8741;"),Q.bowtie=C(E,"\\bowtie","&#8904;"),Q.sqsubset=C(E,"\\sqsubset","&#8847;"),Q.sqsupset=C(E,"\\sqsupset","&#8848;"),Q.smile=C(E,"\\smile","&#8995;"),Q.sqsubseteq=C(E,"\\sqsubseteq","&#8849;"),Q.sqsupseteq=C(E,"\\sqsupseteq","&#8850;"),Q.doteq=C(E,"\\doteq","&#8784;"),Q.frown=C(E,"\\frown","&#8994;"),Q.vdash=C(E,"\\vdash","&#8870;"),Q.dashv=C(E,"\\dashv","&#8867;"),Q.longleftarrow=C(E,"\\longleftarrow","&#8592;"),
Q.longrightarrow=C(E,"\\longrightarrow","&#8594;"),Q.Longleftarrow=C(E,"\\Longleftarrow","&#8656;"),Q.Longrightarrow=C(E,"\\Longrightarrow","&#8658;"),Q.longleftrightarrow=C(E,"\\longleftrightarrow","&#8596;"),Q.updownarrow=C(E,"\\updownarrow","&#8597;"),Q.Longleftrightarrow=C(E,"\\Longleftrightarrow","&#8660;"),Q.Updownarrow=C(E,"\\Updownarrow","&#8661;"),Q.mapsto=C(E,"\\mapsto","&#8614;"),Q.nearrow=C(E,"\\nearrow","&#8599;"),Q.hookleftarrow=C(E,"\\hookleftarrow","&#8617;"),Q.hookrightarrow=C(E,"\\hookrightarrow","&#8618;"),Q.searrow=C(E,"\\searrow","&#8600;"),Q.leftharpoonup=C(E,"\\leftharpoonup","&#8636;"),Q.rightharpoonup=C(E,"\\rightharpoonup","&#8640;"),Q.swarrow=C(E,"\\swarrow","&#8601;"),Q.leftharpoondown=C(E,"\\leftharpoondown","&#8637;"),Q.rightharpoondown=C(E,"\\rightharpoondown","&#8641;"),Q.nwarrow=C(E,"\\nwarrow","&#8598;"),Q.ldots=C(E,"\\ldots","&#8230;"),Q.cdots=C(E,"\\cdots","&#8943;"),Q.vdots=C(E,"\\vdots","&#8942;"),Q.ddots=C(E,"\\ddots","&#8944;"),Q.surd=C(E,"\\surd","&#8730;"),Q.triangle=C(E,"\\triangle","&#9653;"),Q.ell=C(E,"\\ell","&#8467;"),Q.top=C(E,"\\top","&#8868;"),Q.flat=C(E,"\\flat","&#9837;"),Q.natural=C(E,"\\natural","&#9838;"),Q.sharp=C(E,"\\sharp","&#9839;"),Q.wp=C(E,"\\wp","&#8472;"),Q.bot=C(E,"\\bot","&#8869;"),Q.clubsuit=C(E,"\\clubsuit","&#9827;"),Q.diamondsuit=C(E,"\\diamondsuit","&#9826;"),Q.heartsuit=C(E,"\\heartsuit","&#9825;"),Q.spadesuit=C(E,"\\spadesuit","&#9824;"),Q.oint=C(E,"\\oint","&#8750;"),Q.bigcap=C(E,"\\bigcap","&#8745;"),Q.bigcup=C(E,"\\bigcup","&#8746;"),Q.bigsqcup=C(E,"\\bigsqcup","&#8852;"),Q.bigvee=C(E,"\\bigvee","&#8744;"),Q.bigwedge=C(E,"\\bigwedge","&#8743;"),Q.bigodot=C(E,"\\bigodot","&#8857;"),Q.bigotimes=C(E,"\\bigotimes","&#8855;"),Q.bigoplus=C(E,"\\bigoplus","&#8853;"),Q.biguplus=C(E,"\\biguplus","&#8846;"),Q.lfloor=C(E,"\\lfloor","&#8970;"),Q.rfloor=C(E,"\\rfloor","&#8971;"),Q.lceil=C(E,"\\lceil","&#8968;"),Q.rceil=C(E,"\\rceil","&#8969;"),Q.slash=C(E,"\\slash","&#47;"),Q.opencurlybrace=C(E,"\\opencurlybrace","&#123;"),Q.closecurlybrace=C(E,"\\closecurlybrace","&#125;"),Q.caret=C(E,"\\caret ","^"),Q.underscore=C(E,"\\underscore ","_"),Q.backslash=C(E,"\\backslash ","\\"),Q.vert=C(E,"|"),Q.perp=Q.perpendicular=C(E,"\\perp ","&perp;"),Q.nabla=Q.del=C(E,"\\nabla ","&nabla;"),Q.hbar=C(E,"\\hbar ","&#8463;"),Q.AA=Q.Angstrom=Q.angstrom=C(E,"\\text\\AA ","&#8491;"),Q.ring=Q.circ=Q.circle=C(E,"\\circ ","&#8728;"),Q.bull=Q.bullet=C(E,"\\bullet ","&bull;"),Q.setminus=Q.smallsetminus=C(E,"\\setminus ","&#8726;"),Q.not=Q.neg=C(E,"\\neg ","&not;"),Q.dots=Q.ellip=Q.hellip=Q.ellipsis=Q.hellipsis=C(E,"\\dots ","&hellip;"),Q.converges=Q.darr=Q.dnarr=Q.dnarrow=Q.downarrow=C(E,"\\downarrow ","&darr;"),Q.dArr=Q.dnArr=Q.dnArrow=Q.Downarrow=C(E,"\\Downarrow ","&dArr;"),Q.diverges=Q.uarr=Q.uparrow=C(E,"\\uparrow ","&uarr;"),Q.uArr=Q.Uparrow=C(E,"\\Uparrow ","&uArr;"),Q.to=C(G,"\\to ","&rarr;"),Q.rarr=Q.rightarrow=C(E,"\\rightarrow ","&rarr;"),Q.implies=C(G,"\\Rightarrow ","&rArr;"),Q.rArr=Q.Rightarrow=C(E,"\\Rightarrow ","&rArr;"),Q.gets=C(G,"\\gets ","&larr;"),Q.larr=Q.leftarrow=C(E,"\\leftarrow ","&larr;"),Q.impliedby=C(G,"\\Leftarrow ","&lArr;"),Q.lArr=Q.Leftarrow=C(E,"\\Leftarrow ","&lArr;"),Q.harr=Q.lrarr=Q.leftrightarrow=C(E,"\\leftrightarrow ","&harr;"),Q.iff=C(G,"\\Leftrightarrow ","&hArr;"),Q.hArr=Q.lrArr=Q.Leftrightarrow=C(E,"\\Leftrightarrow ","&hArr;"),Q.Re=Q.Real=Q.real=C(E,"\\Re ","&real;"),Q.Im=Q.imag=Q.image=Q.imagin=Q.imaginary=Q.Imaginary=C(E,"\\Im ","&image;"),Q.part=Q.partial=C(E,"\\partial ","&part;"),Q.inf=Q.infin=Q.infty=Q.infinity=C(E,"\\infty ","&infin;"),Q.alef=Q.alefsym=Q.aleph=Q.alephsym=C(E,"\\aleph ","&alefsym;"),Q.xist=Q.xists=Q.exist=Q.exists=C(E,"\\exists ","&exist;"),Q.and=Q.land=Q.wedge=C(E,"\\wedge ","&and;"),Q.or=Q.lor=Q.vee=C(E,"\\vee ","&or;"),Q.o=Q.O=Q.empty=Q.emptyset=Q.oslash=Q.Oslash=Q.nothing=Q.varnothing=C(G,"\\varnothing ","&empty;"),Q.cup=Q.union=C(E,"\\cup ","&cup;"),Q.cap=Q.intersect=Q.intersection=C(E,"\\cap ","&cap;"),Q.deg=Q.degree=C(E,"^\\circ ","&deg;"),Q.ang=Q.angle=C(E,"\\angle ","&ang;"),M=J.prototype=new d,M.respace=function(){this.jQ[0].className=this.next instanceof m||this.next instanceof r?"":"non-italicized-function"},Q.ln=Q.lg=Q.log=Q.span=Q.proj=Q.det=Q.dim=Q.min=Q.max=Q.mod=Q.lcm=Q.gcd=Q.gcf=Q.hcf=Q.lim=J,function(){var a=["sin","cos","tan","sec","cosec","csc","cotan","cot"];for(var b in a)Q[a[b]]=Q[a[b]+"h"]=Q["a"+a[b]]=Q["arc"+a[b]]=Q["a"+a[b]+"h"]=Q["arc"+a[b]+"h"]=J}(),M=K.prototype,M.prev=0,M.next=0,M.parent=0,M.show=function(){return this.jQ=this._jQ.removeClass("blink"),"intervalId"in this?clearInterval(this.intervalId):(this.next?this.jQ.insertBefore(this.selection&&this.selection.prev===this.prev?this.selection.jQ:this.next.jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},M.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=a(),this},M.redraw=function(){for(var a=this.parent;a;a=a.parent)a.redraw&&a.redraw()},M.insertAt=function(a,b,c){var d=this.parent;this.parent=a,this.next=b,this.prev=c,d.blur()},M.insertBefore=function(a){return this.insertAt(a.parent,a,a.prev),this.parent.jQ.addClass("hasCursor"),this.jQ.insertBefore(a.jQ.first()),this},M.insertAfter=function(a){return this.insertAt(a.parent,a.next,a),this.parent.jQ.addClass("hasCursor"),this.jQ.insertAfter(a.jQ.last()),this},M.prependTo=function(a){return this.insertAt(a,a.firstChild,0),a.textarea?this.jQ.insertAfter(a.textarea):this.jQ.prependTo(a.jQ),a.focus(),this},M.appendTo=function(a){return this.insertAt(a,0,a.lastChild),this.jQ.appendTo(a.jQ),a.focus(),this},M.hopLeft=function(){return this.jQ.insertBefore(this.prev.jQ.first()),this.next=this.prev,this.prev=this.prev.prev,this},M.hopRight=function(){return this.jQ.insertAfter(this.next.jQ.last()),this.prev=this.next,this.next=this.next.next,this},M.moveLeft=function(){return this.selection?this.insertBefore(this.selection.prev.next||this.parent.firstChild).clearSelection():this.prev?this.prev.lastChild?this.appendTo(this.prev.lastChild):this.hopLeft():this.parent.prev?this.appendTo(this.parent.prev):this.parent!==this.root&&this.insertBefore(this.parent.parent),this.show()},M.moveRight=function(){return this.selection?this.insertAfter(this.selection.next.prev||this.parent.lastChild).clearSelection():this.next?this.next.firstChild?this.prependTo(this.next.firstChild):this.hopRight():this.parent.next?this.prependTo(this.parent.next):this.parent!==this.root&&this.insertAfter(this.parent.parent),this.show()},M.seek=function(a,b,c){var d=this;if(a.hasClass("empty"))return d.clearSelection().prependTo(a.data(O).block),d;var e=a.data(O);if(e){if(e.cmd&&!e.block)return d.clearSelection(),a.outerWidth()>2*(b-a.offset().left)?d.insertBefore(e.cmd):d.insertAfter(e.cmd),d}else a=a.parent(),e=a.data(O),e||(e={block:d.root});d.clearSelection(),e.cmd?d.insertAfter(e.cmd):d.appendTo(e.block);var f,g=d.jQ.offset().left-b;do d.moveLeft(),f=g,g=d.jQ.offset().left-b;while(g>0&&(d.prev||d.parent!==d.root));return-g>f&&d.moveRight(),d},M.resolveNonItalicizedFunctions=function(){for(var a=this.prev,b=a?a.latex().replace(/ $/,""):null,c=0,d={ln:1,lg:1,log:1,span:1,proj:1,det:1,dim:1,min:1,max:1,mod:1,lcm:1,gcd:1,gcf:1,hcf:1,lim:1,sin:1,sinh:1,asin:1,arcsin:1,asinh:1,arcsinh:1,cos:1,cosh:1,acos:1,arccos:1,acosh:1,arccosh:1,tan:1,tanh:1,atan:1,arctan:1,atanh:1,arctanh:1,sec:1,sech:1,asec:1,arcsec:1,asech:1,arcsech:1,cosec:1,cosech:1,acosec:1,arccosec:1,acosech:1,arccosech:1,csc:1,csch:1,acsc:1,arccsc:1,acsch:1,arccsch:1,cotan:1,cotanh:1,acotan:1,arccotan:1,acotanh:1,arccotanh:1,cot:1,coth:1,acot:1,arccot:1,acoth:1,arccoth:1},e="";a&&b;){var f=b.match(/^[a-z]$/);if(!(f||e&&"\\"==b[0]&&d[b.substring(1)]&&d[(b+e).substring(1)]))return;if(c++,e=b.replace(/\\/,"")+e,a=a.prev,b=a?a.latex().replace(/ $/,""):null,!f||(!a||!b.match(/^[a-z]$/))&&d[e]){for(var g=0;c>g;g++)this.selectLeft();return void this.writeLatex("\\"+e)}}},M.writeLatex=function(b,c){return this.deleteSelection(),b=b&&b.match(/\\text\{([^{}]|\\\[{}])*\}|\\[\{\}\[\]]|[\(\)]|\\[a-z]*|[^\s]/gi)||0,function d(e){for(;b.length;){var f=b.shift();if(!f||"}"===f||"]"===f)return;var g;if("\\text{"!==f.slice(0,6)){if("|"===f){for(var h=e.prev&&e.prev.prev;h&&("|"!=h.cmd||!h.isEmpty());)h=h.prev;if(h){h.remove(),e.selectFrom(h.next),e.show().insertCh(f).insertAfter(e.parent.parent);continue}g=new E(f),e.insertNew(g)}else if(a.inArray(f,["\\lbrace","\\{","\\rbrace","\\}","\\langle","\\lang","\\rangle","\\rang","\\lparen","(","\\rparen",")","\\lbrack","\\lbracket","\\[","\\rbrack","\\rbracket","\\]","\\lpipe","\\rpipe"])>=0){if(f=f.replace(/^\\/,""),e.insertCh(f),g=e.prev||e.parent.parent,e.prev)return;b.unshift("{")}else if(/^\\[a-z]+$/i.test(f)){f=f.slice(1);var g=Q[f];if(!g){g=new w(f),e.insertNew(g).insertAfter(g);continue}g=new g(N,f),"["===b[0]&&g.optional_arg_command&&(f=g.optional_arg_command,g=new Q[f](N,f)),e.insertNew(g)}else g=f.match(/[a-eg-zA-Z]/)?new D(f):(g=Q[f])?new g:new E(f),e.insertNew(g);g.eachChild(function(a){e.appendTo(a);var c=b.shift();return c?void("{"===c||"["===c?d(e):e.insertCh(c)):!1}),c||e.insertAfter(g)}else g=new w(f.slice(6,-1)),e.insertNew(g).insertAfter(g)}}(this),this.hide()},M.write=function(a){var b=this.show().insertCh(a);return this.root.toolbar&&this.resolveNonItalicizedFunctions(),b},M.insertCh=function(a){this.selection&&(this.prev=this.selection.prev,this.next=this.selection.next);var b;return b=a.match(/^[a-eg-zA-Z]$/)?new D(a):(b=P[a]||Q[a])?new b(this.selection,a):new E(a),this.selection&&(b instanceof d&&this.selection.remove(),delete this.selection),this.insertNew(b)},M.insertNew=function(a){return a.parent=this.parent,a.next=this.next,a.prev=this.prev,this.prev?this.prev.next=a:this.parent.firstChild=a,this.next?this.next.prev=a:this.parent.lastChild=a,a.jQ.insertBefore(this.jQ),a.respace(),this.next&&this.next.respace(),this.prev&&this.prev.respace(),this.prev=a,a.placeCursor(this),this.redraw(),this},M.unwrapGramp=function(){var a=this.parent.parent,b=a.parent,c=a.prev;if(a.eachChild(function(d){d.isEmpty()||(d.eachChild(function(c){c.parent=b,c.jQ.insertBefore(a.jQ)}),d.firstChild.prev=c,c?c.next=d.firstChild:b.firstChild=d.firstChild,c=d.lastChild)}),c.next=a.next,a.next?a.next.prev=c:b.lastChild=c,!this.next)if(this.prev)this.next=this.prev.next;else for(;!this.next;){if(this.parent=this.parent.next,!this.parent){this.next=a.next,this.parent=b;break}this.next=this.parent.firstChild}this.next?this.insertBefore(this.next):this.appendTo(b),a.jQ.remove(),a.prev&&a.prev.respace(),a.next&&a.next.respace()},M.backspace=function(){if(this.deleteSelection());else if(this.prev)this.prev.isEmpty()?this.prev=this.prev.remove().prev:this.selectLeft();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertAfter(this.parent.parent).backspace();this.unwrapGramp()}return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.redraw(),this},M.deleteForward=function(){if(this.deleteSelection());else if(this.next)this.next.isEmpty()?this.next=this.next.remove().next:this.selectRight();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertBefore(this.parent.parent).deleteForward();this.unwrapGramp()}return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.redraw(),this},M.selectFrom=function(a){var b=this,c=a;a:for(;;){for(var d=this;d!==b.parent.parent;d=d.parent.parent)if(d.parent===c.parent){f=d,g=c;break a}for(var e=a;e!==c.parent.parent;e=e.parent.parent)if(b.parent===e.parent){f=b,g=e;break a}b.parent.parent&&(b=b.parent.parent),c.parent.parent&&(c=c.parent.parent)}var f,g,h;if(f.next!==g){for(var i=f;i;i=i.next)if(i===g.prev){h=!0;break}h||(h=g,g=f,f=h)}this.hide().selection=new L(f.parent,f.prev,g.next),this.insertAfter(g.next.prev||g.parent.lastChild),this.selectLatex()},M.selectLeft=function(){this.selection?this.selection.prev===this.prev?this.prev?(this.hopLeft().next.jQ.prependTo(this.selection.jQ),this.selection.prev=this.prev):this.parent!==this.root&&this.insertBefore(this.parent.parent).selection.levelUp():(this.prev.jQ.insertAfter(this.selection.jQ),this.hopLeft().selection.next=this.next,this.selection.prev===this.prev&&this.deleteSelection()):(this.prev?this.hopLeft():this.parent!==this.root&&this.insertBefore(this.parent.parent),this.hide().selection=new L(this.parent,this.prev,this.next.next)),this.selectLatex()},M.selectRight=function(){this.selection?this.selection.next===this.next?this.next?(this.hopRight().prev.jQ.appendTo(this.selection.jQ),this.selection.next=this.next):this.parent!==this.root&&this.insertAfter(this.parent.parent).selection.levelUp():(this.next.jQ.insertBefore(this.selection.jQ),this.hopRight().selection.prev=this.prev,this.selection.next===this.next&&this.deleteSelection()):(this.next?this.hopRight():this.parent!==this.root&&this.insertAfter(this.parent.parent),this.hide().selection=new L(this.parent,this.prev.prev,this.next)),this.selectLatex()},M.selectLatex=function(){var a=this.root.textarea.children(),b=this.selection?this.selection.latex():"";if(a.val(b),"number"==typeof a[0].selectionStart)a[0].selectionStart=0,a[0].selectionEnd=b.length;else if(document.selection){var c=a[0].createTextRange();c.collapse(!0),c.moveStart("character",0),c.moveEnd("character",b.length),c.select()}},M.clearSelection=function(){return this.root.textarea.children().val(""),this.show().selection&&(this.selection.clear(),delete this.selection),this},M.deleteSelection=function(){return this.show().selection?(this.prev=this.selection.prev,this.next=this.selection.next,this.selection.remove(),delete this.selection,!0):!1},M=L.prototype=new f,M.jQinit=function(a){this.jQ=a.wrapAll('<span class="selection"></span>').parent()},M.levelUp=function(){return this.clear().jQinit(this.parent.parent.jQ),this.prev=this.parent.parent.prev,this.next=this.parent.parent.next,this.parent=this.parent.parent.parent,this},M.clear=function(){return this.jQ.replaceWith(this.jQ.children()),this},M.blockify=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),f.prototype.blockify.call(this)},M.detach=function(){var a=f.prototype.blockify.call(this);return this.blockify=function(){return this.jQ.replaceWith(a.jQ=this.jQ=this.jQ.children()),a},this},a.fn.mathquill=function(b,c){switch(b){case"redraw":return this.find(":not(:has(:first))").data(O).cmd.redraw(),this;case"revert":return this.each(function(){var b=a(this).data(O);b&&b.revert&&b.revert()});case"latex":if(arguments.length>1)return this.each(function(){var b=a(this).data(O);b&&b.block&&b.block.renderLatex&&b.block.renderLatex(c)});var d=this.data(O);return d&&d.block&&d.block.latex();case"text":var d=this.data(O);return d&&d.block&&d.block.text();case"html":return this.html().replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case"write":if(arguments.length>1)return this.each(function(){var b=a(this).data(O),d=b&&b.block,e=d&&d.cursor;e&&(e.writeLatex(c),d.blur())});default:var e="textbox"===b,f="editor"===b,h=f||e||"editable"===b,j=e?k:i;return this.each(function(){g(a(this),new j,e,h,f)})}},a(function(){a(".mathquill-editable").mathquill("editable"),a(".mathquill-editor").mathquill("editor"),a(".mathquill-textbox").mathquill("textbox"),a(".mathquill-embedded-latex").mathquill()})}(jQuery);